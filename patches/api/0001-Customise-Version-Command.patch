From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Samsuik <40902469+Samsuik@users.noreply.github.com>
Date: Wed, 2 Aug 2023 18:00:04 +0100
Subject: [PATCH] Customise Version Command


diff --git a/src/main/java/org/bukkit/Bukkit.java b/src/main/java/org/bukkit/Bukkit.java
index b0bc2df41506770e2854a287813f1c53f003eda1..0a5e8d88f0f18a8e5295ead8f5c75be7d3fd2d2b 100644
--- a/src/main/java/org/bukkit/Bukkit.java
+++ b/src/main/java/org/bukkit/Bukkit.java
@@ -126,6 +126,20 @@ public final class Bukkit {
         // Paper end
     }
 
+    // Sakura start - expose git info
+    @NotNull
+    public static String getGitInformation() {
+        final var manifest = JarManifests.manifest(Bukkit.getServer().getClass());
+        final String gitBranch = manifest == null ? null : manifest.getMainAttributes().getValue("Git-Branch");
+        final String gitCommit = manifest == null ? null : manifest.getMainAttributes().getValue("Git-Commit");
+        String branchMsg = " on " + gitBranch;
+        if ("master".equals(gitBranch) || "main".equals(gitBranch)) {
+            branchMsg = "";  // Don't show branch on main/master
+        }
+        return "(Git: " + gitCommit + branchMsg + ")";
+    }
+    // Sakura end
+
     /**
      * Gets the name of this server implementation.
      *
diff --git a/src/main/java/org/bukkit/command/defaults/VersionCommand.java b/src/main/java/org/bukkit/command/defaults/VersionCommand.java
index e40f017f87d6b6b4770501b106c76dc69ec69abb..ac781fdd9dac6e124f53a15560c97aa3df314b08 100644
--- a/src/main/java/org/bukkit/command/defaults/VersionCommand.java
+++ b/src/main/java/org/bukkit/command/defaults/VersionCommand.java
@@ -25,6 +25,13 @@ import org.bukkit.plugin.Plugin;
 import org.bukkit.plugin.PluginDescriptionFile;
 import org.bukkit.util.StringUtil;
 import org.jetbrains.annotations.NotNull;
+// Sakura start
+import net.kyori.adventure.text.Component;
+import net.kyori.adventure.text.event.HoverEvent;
+import net.kyori.adventure.text.format.NamedTextColor;
+import net.kyori.adventure.text.minimessage.MiniMessage;
+import net.kyori.adventure.text.minimessage.tag.resolver.Placeholder;
+// Sakura end
 
 public class VersionCommand extends BukkitCommand {
     private VersionFetcher versionFetcher;
@@ -36,6 +43,15 @@ public class VersionCommand extends BukkitCommand {
         return versionFetcher;
     }
 
+    // Sakura start
+    private static final String VERSION_MESSAGE = """
+                <dark_purple>.
+                <dark_purple>| <white>This server is running <gradient:red:light_purple>Sakura</gradient>
+                <dark_purple>| <white>Commit<dark_gray>: \\<<commit>> <gray>targeting </gray>(<yellow>MC</yellow>: <gray><version></gray>)
+                <dark_purple>| <white>Github<dark_gray>: \\<<yellow><click:open_url:'https://github.com/Samsuik/Sakura'>link</click></yellow>>
+                <dark_purple>'""";
+    // Sakura end
+
     public VersionCommand(@NotNull String name) {
         super(name);
 
@@ -47,12 +63,18 @@ public class VersionCommand extends BukkitCommand {
 
     @Override
     public boolean execute(@NotNull CommandSender sender, @NotNull String currentAlias, @NotNull String[] args) {
-        if (!testPermission(sender)) return true;
+        // Sakura - move down into else
 
         if (args.length == 0) {
             //sender.sendMessage("This server is running " + Bukkit.getName() + " version " + Bukkit.getVersion() + " (Implementing API version " + Bukkit.getBukkitVersion() + ")"); // Paper - moved to setVersionMessage
-            sendVersion(sender);
-        } else {
+            // Sakura start
+            sender.sendMessage(MiniMessage.miniMessage().deserialize(VERSION_MESSAGE,
+                Placeholder.component("commit", Component.text("hover", NamedTextColor.YELLOW)
+                    .hoverEvent(HoverEvent.showText(Component.text(Bukkit.getGitInformation())))),
+                Placeholder.unparsed("version", Bukkit.getMinecraftVersion())
+            ));
+        } else if (testPermission(sender)) {
+            // Sakura end
             StringBuilder name = new StringBuilder();
 
             for (String arg : args) {
